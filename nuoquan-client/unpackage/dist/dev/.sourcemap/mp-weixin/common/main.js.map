{"version":3,"sources":["webpack:///D:/XMQ/nuoquan/nuoquan-client/main.js","webpack:///D:/XMQ/nuoquan/nuoquan-client/App.vue?2cd6","webpack:///D:/XMQ/nuoquan/nuoquan-client/App.vue?3da6","webpack:///D:/XMQ/nuoquan/nuoquan-client/App.vue","webpack:///D:/XMQ/nuoquan/nuoquan-client/App.vue?1a1b","webpack:///D:/XMQ/nuoquan/nuoquan-client/App.vue?b4ff"],"names":["app","Vue","store","App","$mount","mpType","config","productionTip","prototype","version","tagColors","$store","$serverUrl","$wsServerUrl","setGlobalUserInfo","user","uni","setStorageSync","getGlobalUserInfo","value","getStorageSync","removeGlobalUserInfo","removeStorageSync","setIntoList","obj","listName","listStr","list","isNull","JSON","parse","push","stringify","addIntoList","unshift","getListByKey","setUserInfoToUserList","userInfo","userListStr","userList","i","length","id","splice","getUserInfoFromUserList","userId","getCurrentPage","pages","getCurrentPages","currentPage","myUser","email","split","emailPrefix","emailSuffix","str","undefined","isBlank","RegExp","test","mySocket","isOpen","socketMsgQueue","init","that","connectSocket","url","complete","onSocketOpen","res","console","log","myUserId","dataContent","netty","DataContent","CONNECT","sendDataContent","action","CHAT","chat","fetchUnsignedChatMsg","notification","fetchUnsignedLikeMsg","fetchUnsignedCommentMsg","setInterval","keepAlive","onSocketError","onSocketMessage","data","LIKEARTICLE","LIKECOMMENT","COMMENTARTICLE","COMMENTCOMMENT","commit","chatMessage","signMsgList","msgId","myId","receiverId","friendId","senderId","msg","createDate","saveUserChatHistory","FRIEND","page","route","pageFriendId","friendInfo","saveUserChatSnapshot","READ","newMessage","ChatHistory","UNREAD","signLikeArticleList","source","saveLikeMsg","signLikeCommentList","signCommentList","saveCommentMsg","onSocketClose","setTimeout","sendObj","toUserId","extand","timeStamp","Date","getTime","ChatMessage","isSocketOpen","sendSocketMessage","ME","msgIds","SIGNED","LIKEARTICLE_SIGN","LIKECOMMENT_SIGN","COMMENT_SIGN","KEEPALIVE","flag","ChatSnapshot","isRead","chatKey","chatHistoryListStr","chatHistoryList","singleMsg","getUserChatHistory","reverse","size","start","newList","deletUserChatHistory","chatSnapshotListStr","chatSnapshotList","getUserChatSnapShot","deletUserChatSnapShot","readUserChatSnapShot","item","request","method","header","success","status","unsignedMsgList","msgObj","acceptUserId","sendUserId","LIKEMSG_KEY","COMMENTMSG_KEY","getLikeMsg","getCommentMsg","likeArticleIds","likeCommentIds","commentIds","timeDeal","timediff","parts","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","oldTime","now","newTime","milliseconds","timeSpanStr","Math","round","mixin","methods","setTabBarIndex","index","$mp","getTabBar","setData","selected","onLaunch","onShow","onHide"],"mappings":"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","file":"common/main.js","sourcesContent":["import 'uni-pages';import '@dcloudio/uni-stat';\r\nimport Vue from 'vue'\r\nimport App from './App'\r\nimport store from './store' // 引入 vuex 的 store 对象\r\n// import {mapMutations} from 'vuex';\r\n\r\nconst app = new Vue({\r\n\tstore,\r\n\t...App\r\n})\r\napp.$mount()\r\nApp.mpType = 'app'\r\n\r\nVue.config.productionTip = false\r\n\r\nVue.prototype.version = \"v1.0.3 - 公测版\"\r\nVue.prototype.tagColors = ['#FE5F55','#40A792','#FDD041','#5CA0D3','#621E81','#738598','#F3AE4B']\r\n\r\nVue.prototype.$store = store\r\n\r\n// Vue.prototype.$serverUrl = \"http://127.0.0.1:8080\"\r\n// Vue.prototype.$wsServerUrl = \"wss://127.0.0.1:8088/ws\"\r\n\r\n// 服务器地址\r\n// Vue.prototype.$serverUrl = \"http://129.28.130.27:8080/nottinghome\"\r\n// Vue.prototype.$wsServerUrl = \"ws://129.28.130.27:8088/ws\"\r\n\r\n// 安全服务器地址\r\nVue.prototype.$serverUrl = \"https://www.checkchack.cn:8443/nottinghome\"\r\nVue.prototype.$wsServerUrl = \"wss://www.checkchack.cn:8088/ws\"\r\n\r\n/**\r\n * 获取当前用户信息（我）\r\n * @param {Object} user\r\n */\r\nVue.prototype.setGlobalUserInfo = function(user) {\r\n\tuni.setStorageSync('userInfo', user);\r\n}\r\n\r\n/**\r\n * 设置当前用户信息\r\n */\r\nVue.prototype.getGlobalUserInfo = function() {\r\n\tvar value = uni.getStorageSync('userInfo');\r\n\treturn value;\r\n}\r\n\r\n/**\r\n * 清空当前用户信息\r\n */\r\nVue.prototype.removeGlobalUserInfo = function() {\r\n\tuni.removeStorageSync('userInfo');\r\n}\r\n\r\n/**\r\n * 把对象添加到列表尾部，并储存在缓存里\r\n * @param {Object} obj\r\n * @param {Object} list\r\n */\r\nVue.prototype.setIntoList = function(obj, listName) {\r\n\tvar listStr = uni.getStorageSync(listName)\r\n\t// 从本地缓存获取列表名是否存在\r\n\tvar list;\r\n\tif (app.isNull(listStr)) {\r\n\t\t// 为空，赋一个空的list；\r\n\t\tlist = [];\r\n\t} else {\r\n\t\t// 不为空\r\n\t\tlist = JSON.parse(listStr);\r\n\t}\r\n\t// 插入对象到尾部\r\n\tlist.push(obj);\r\n\tuni.setStorageSync(listName, JSON.stringify(list));\r\n}\r\n/**\r\n * 把对象添加到列表头部，并储存在缓存里\r\n * @param {Object} obj\r\n * @param {Object} listName\r\n */\r\nVue.prototype.addIntoList = function(obj, listName) {\r\n\tvar listStr = uni.getStorageSync(listName)\r\n\t// 从本地缓存获取列表名是否存在\r\n\tvar list;\r\n\tif (app.isNull(listStr)) {\r\n\t\t// 为空，赋一个空的list；\r\n\t\tlist = [];\r\n\t} else {\r\n\t\t// 不为空\r\n\t\tlist = JSON.parse(listStr);\r\n\t}\r\n\t// 插入对象到头部\r\n\tlist.unshift(obj);\r\n\tuni.setStorageSync(listName, JSON.stringify(list));\r\n}\r\n/**\r\n * 从缓存中按名字获取改名列表\r\n * @param {Object} listName\r\n */\r\nVue.prototype.getListByKey = function(listName){\r\n\tvar listStr = uni.getStorageSync(listName);\r\n\tvar list;\r\n\tif (app.isNull(listStr)) {\r\n\t\t// 为空，赋一个空的list；\r\n\t\tlist = [];\r\n\t} else {\r\n\t\t// 不为空\r\n\t\tlist = JSON.parse(listStr);\r\n\t}\r\n\t\r\n\treturn list;\r\n}\r\n\r\n\r\n/** TODO: 可使用 Map 代替 List 提升查询性能（暂时不知道 map 在 uniapp 中怎么写）\r\n *\t \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tby Jerrio\r\n * 把该用户信息添加到本地缓存的 userlist 中，如果存在则替换\r\n * @param {Object} userInfo\r\n */\r\nVue.prototype.setUserInfoToUserList = function(userInfo) {\r\n\tvar userListStr = uni.getStorageSync(\"userList\");\r\n\tvar userList;\r\n\tif (app.isNull(userListStr)) {\r\n\t\t// 为空，赋一个空的list；\r\n\t\tuserList = [];\r\n\t} else {\r\n\t\t// 不为空，查看该用户是否存在\r\n\t\tvar userList = JSON.parse(userListStr);\r\n\t\tfor (var i = 0; i < userList.length; i++) {\r\n\t\t\tvar user = userList[i];\r\n\t\t\tif (user.id == userInfo.id) {\r\n\t\t\t\tuserList.splice(i, 1, userInfo); // 替换\r\n\t\t\t\tuni.setStorageSync(\"userList\", JSON.stringify(userList));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// 用户不存在\r\n\tuserList.push(userInfo);\r\n\tuni.setStorageSync(\"userList\", JSON.stringify(userList));\r\n}\r\n\r\n/**\r\n * 根据 userId，在本地缓存中获取该用户信息\r\n * @param {Object} userId\r\n */\r\nVue.prototype.getUserInfoFromUserList = function(userId) {\r\n\tvar userListStr = uni.getStorageSync(\"userList\");\r\n\r\n\tif (app.isNull(userListStr)) {\r\n\t\t// 为空，直接返回 null\r\n\t\treturn null;\r\n\t} else {\r\n\t\t// 不为空\r\n\t\tvar userList = JSON.parse(userListStr);\r\n\t\tfor (var i = 0; i < userList.length; i++) {\r\n\t\t\tvar user = userList[i];\r\n\t\t\tif (user.id == userId) {\r\n\t\t\t\treturn user;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n/**\r\n * 返回页面栈最后一页(当前页面)\r\n */\r\nVue.prototype.getCurrentPage = function() {\r\n\tvar pages = getCurrentPages();\r\n\tvar currentPage = pages[pages.length - 1];\r\n\treturn currentPage;\r\n}\r\n/**\r\n * 从服务器查询用户信息, 并拼接额外信息。\r\n * [需要设置同步否则得不到值，还未测试，暂时弃用，请手动调用myUser拼接]\r\n */\r\n// Vue.prototype.myQueryUserInfo = async function(userId) {\r\n// \tvar that = this;\r\n// \tvar finalUser;\r\n// \tuni.request({\r\n// \t\turl: that.$serverUrl + '/user/queryUser',\r\n// \t\tmethod: \"POST\",\r\n// \t\tdata: {\r\n// \t\t\tuserId: userId\r\n// \t\t},\r\n// \t\theader: {\r\n// \t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n// \t\t},\r\n// \t\tsuccess: (res) => {\r\n// \t\t\t// console.log(res)\r\n// \t\t\tif (res.data.status == 200) {\r\n// \t\t\t\t// 3.获取返回的用户信息\r\n// \t\t\t\tfinalUser = res.data.data;\r\n// \t\t\t\t// 4.分割邮箱地址, 重构user\r\n// \t\t\t\tfinalUser = that.myUser(finalUser);\r\n// \t\t\t}\r\n// \t\t\tconsole.log(\"里面\");\r\n// \t\t\tconsole.log(finalUser);\r\n// \t\t\treturn finalUser;\r\n// \t\t}\r\n// \t});\r\n// \t\r\n// \t// app.$nextTick(function(){\r\n// \t// \tconsole.log(finalUser);\r\n// \t// })\r\n// \t\r\n// \t// console.log(\"里面2\");\r\n// \t// console.log(finalUser);\r\n// \t// return finalUser;\r\n// }\r\n\r\n/**\r\n * 分割邮箱地址, 重构user\r\n * @param {Object} user\r\n */\r\nVue.prototype.myUser = function(user) {\r\n\t// 分割邮箱地址\r\n\tvar email = user.email;\r\n\tif (this.isNull(email)) {\r\n\t\temail = \"[Email]@nottingham.edu.cn\";\r\n\t}\r\n\tvar list = email.split('@');\r\n\tuser.emailPrefix = list[0];\r\n\tuser.emailSuffix = \"@\" + list[1];\r\n\r\n\treturn user\r\n}\r\n\r\nVue.prototype.isNull = function(str) {\r\n\tif (str == null || str == \"\" || str == undefined) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * \"\" = true;\r\n * \" \" = true;\r\n */\r\nVue.prototype.isBlank = function(str) {\r\n\treturn RegExp(/^\\s*$/).test(str);\r\n}\r\n\r\n/**\r\n * 自定义封装 socket 供全局调用\r\n * @author: Jerrio\r\n */\r\nVue.prototype.mySocket = {\r\n\r\n\tisOpen: false,\r\n\tsocketMsgQueue: [], // 未发送的消息队列\t\r\n\r\n\tinit: function() {\r\n\t\tvar that = this;\r\n\t\t// 创建websocket长连接\r\n\t\tuni.connectSocket({\r\n\t\t\turl: app.$wsServerUrl,\r\n\t\t\tcomplete: () => {}\r\n\t\t});\r\n\r\n\t\tuni.onSocketOpen(function(res) {\r\n\t\t\tthat.isOpen = true;\r\n\t\t\tconsole.log('WebSocket连接已打开！isSocketOpen=' + that.isOpen);\r\n\t\t\t//发送连接消息，向服务器注册信息\r\n\t\t\tvar myUserId = app.getGlobalUserInfo().id; // 调用全局用户缓存，需要先请求获取\r\n\t\t\tif (app.isNull(myUserId)) {\r\n\t\t\t\tconsole.log(\"请先获取用户数据\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar dataContent = new app.netty.DataContent(app.netty.CONNECT, null, myUserId);\r\n\t\t\tthat.sendDataContent(dataContent);\r\n\t\t\t// 发送未发送的信息\r\n\t\t\tfor (var i = 0; i < that.socketMsgQueue.length; i++) {\r\n\t\t\t\tif (that.socketMsgQueue[i].action == app.netty.CHAT){\r\n\t\t\t\t\tthat.sendDataContent(that.socketMsgQueue[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthat.socketMsgQueue = [];\r\n\r\n\t\t\t// 签收未签收消息\r\n\t\t\tapp.chat.fetchUnsignedChatMsg(); // 获取聊天信息\r\n\t\t\tapp.notification.fetchUnsignedLikeMsg(); // 获取点赞通知\r\n\t\t\tapp.notification.fetchUnsignedCommentMsg(); // 获取评论通知\r\n\t\t\t// 定时发送心跳\r\n\t\t\tsetInterval(that.keepAlive, 50000);\r\n\t\t});\r\n\r\n\t\tuni.onSocketError(function(res) {\r\n\t\t\tconsole.log('WebSocket连接打开失败，请检查！');\r\n\t\t});\r\n\r\n\t\tuni.onSocketMessage(function(res) {\r\n\t\t\tvar dataContent = JSON.parse(res.data);\r\n\t\t\tconsole.log(\"收到服务器内容：\");\r\n\t\t\tconsole.log(dataContent);\r\n\t\t\tvar action = dataContent.action;\r\n\r\n\t\t\tif (action == app.netty.CHAT \r\n\t\t\t\t|| action == app.netty.LIKEARTICLE \r\n\t\t\t\t|| action == app.netty.LIKECOMMENT\r\n\t\t\t\t|| action == app.netty.COMMENTARTICLE\r\n\t\t\t\t|| action == app.netty.COMMENTCOMMENT) {\r\n\t\t\t\t\r\n\t\t\t\tapp.$store.commit('setMyMsgCount'); // 累加 msgCount in index.js\r\n\t\t\t\t\r\n\t\t\t\tswitch (action){\r\n\t\t\t\t\tcase app.netty.CHAT: // 如果消息类型为 CHAT\r\n\t\t\t\t\t\tvar chatMessage = dataContent.data;\r\n\t\t\t\t\t\t// 发送签收消息\r\n\t\t\t\t\t\tthat.signMsgList(chatMessage.msgId);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 保存聊天历史记录到本地缓存\r\n\t\t\t\t\t\tvar myId = chatMessage.receiverId;\r\n\t\t\t\t\t\tvar friendId = chatMessage.senderId;\r\n\t\t\t\t\t\tvar msg = chatMessage.msg;\r\n\t\t\t\t\t\tvar createDate = chatMessage.createDate; // 对时间戳进行格式化\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tapp.chat.saveUserChatHistory(myId, friendId, msg, app.chat.FRIEND, createDate);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 判断当前页面，保存聊天快照\r\n\t\t\t\t\t\tvar page = app.getCurrentPage();\r\n\t\t\t\t\t\tif (page.route == 'pages/chatpage/chatpage') {\r\n\t\t\t\t\t\t\tvar pageFriendId = page.data.friendInfo.id; // 打开页面才有对象，越层判断会报对象为空的错\r\n\t\t\t\t\t\t\t/* \r\n\t\t\t\t\t\t\t【BUG】ISO 虚拟机获取 friendInfo.id 报错信息：\r\n\t\t\t\t\t\t\t undefined is not an object (evaluating 'page.data.friendInfo.id')\r\n\t\t\t\t\t\t\t 不知道真机会不会有这种情况\r\n\t\t\t\t\t\t\t*/\r\n\t\t\t\t\t\t\t// var pagestr = JSON.stringify(page.data);\r\n\t\t\t\t\t\t\t// console.log(pagestr);\r\n\t\t\t\t\t\t\tif (pageFriendId == friendId) {\r\n\t\t\t\t\t\t\t\t// 与该用户在聊天，标记为已读\r\n\t\t\t\t\t\t\t\tconsole.log(\"与该用户在聊天，标记为已读\");\r\n\t\t\t\t\t\t\t\tapp.chat.saveUserChatSnapshot(myId, friendId, msg, app.chat.READ, createDate);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// 修改 store，发送信号，把消息卡片渲染到对话窗口 和 消息列表\r\n\t\t\t\t\t\t\t\tvar newMessage = new app.chat.ChatHistory(myId, friendId, msg, app.chat.FRIEND, createDate);\r\n\t\t\t\t\t\t\t\tapp.$store.commit('setChatMessageCard', newMessage);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t//不是与该用户聊天，标记为未读\r\n\t\t\t\t\t\t\t\tconsole.log(\"不是与该用户聊天，标记为未读\");\r\n\t\t\t\t\t\t\t\tapp.chat.saveUserChatSnapshot(myId, friendId, msg, app.chat.UNREAD, createDate);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// 聊天页面未打开，标记为未读\r\n\t\t\t\t\t\t\tconsole.log(\"聊天页面未打开，标记为未读\");\r\n\t\t\t\t\t\t\tapp.chat.saveUserChatSnapshot(myId, friendId, msg, app.chat.UNREAD, createDate);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase app.netty.LIKEARTICLE:\r\n\t\t\t\t\t\tconsole.log(\"获取点赞文章\");\r\n\t\t\t\t\t\t// 签收消息\r\n\t\t\t\t\t\tthat.signLikeArticleList(dataContent.data.source.id);\r\n\t\t\t\t\t\t// 存入缓存 (TODO：登陆时获取未签收点赞消息)\r\n\t\t\t\t\t\tapp.notification.saveLikeMsg(dataContent);\r\n\t\t\t\t\t\tapp.$store.commit('setLikeMsgCount');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase app.netty.LIKECOMMENT:\r\n\t\t\t\t\t\tconsole.log(\"获取点赞评论\");\r\n\t\t\t\t\t\t// 签收消息\r\n\t\t\t\t\t\tthat.signLikeCommentList(dataContent.data.source.id);\r\n\t\t\t\t\t\t// 存入缓存\r\n\t\t\t\t\t\tapp.notification.saveLikeMsg(dataContent);\r\n\t\t\t\t\t\tapp.$store.commit('setLikeMsgCount');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase app.netty.COMMENTARTICLE:\r\n\t\t\t\t\t\tconsole.log(\"获取评论文章\");\r\n\t\t\t\t\t\t// 签收消息\r\n\t\t\t\t\t\tthat.signCommentList(dataContent.data.source.id);\r\n\t\t\t\t\t\t// 存入缓存\r\n\t\t\t\t\t\tapp.notification.saveCommentMsg(dataContent);\r\n\t\t\t\t\t\tapp.$store.commit('setCommentMsgCount');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase app.netty.COMMENTCOMMENT:\r\n\t\t\t\t\t\tconsole.log(\"获取评论评论\");\r\n\t\t\t\t\t\t// 签收消息\r\n\t\t\t\t\t\tthat.signCommentList(dataContent.data.source.id);\r\n\t\t\t\t\t\t// 存入缓存\r\n\t\t\t\t\t\tapp.notification.saveCommentMsg(dataContent);\r\n\t\t\t\t\t\tapp.$store.commit('setCommentMsgCount');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tuni.onSocketClose(function(res) {\r\n\t\t\tthat.isOpen = false;\r\n\t\t\tconsole.log('WebSocket 已关闭！isSocketOpen=' + that.isOpen);\r\n\t\t\t// 三秒一次重连\r\n\t\t\tconsole.log(\"重连中..\");\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tthat.init();\r\n\t\t\t}, 3000);\r\n\t\t});\r\n\r\n\t},\r\n\t/**\r\n\t * 向 netty 服务器发送 聊天信息的方法 sendChatObj\r\n\t * @param {Object} type\r\n\t * @param {Object} toUserId\r\n\t * @param {Object} msg\r\n\t * @param {Object} extand\r\n\t */\r\n\tsendObj(action, toUserId, msg, extand) {\r\n\t\tvar myUserId = app.getGlobalUserInfo().id; // 调用全局用户缓存，需要先请求获取\r\n\t\tif (app.isNull(myUserId)) {\r\n\t\t\tconsole.log(\"请先获取用户数据\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 获取当前时间戳，传输时间戳\r\n\t\tvar timeStamp = new Date().getTime();\r\n\r\n\t\t// 构建载体\r\n\t\tvar chatMessage = new app.netty.ChatMessage(myUserId, toUserId, msg, null, timeStamp);\r\n\t\tvar dataContent = new app.netty.DataContent(action, chatMessage, extand);\r\n\r\n\t\tvar isSocketOpen = app.mySocket.isOpen;\r\n\t\tif (isSocketOpen == true) {\r\n\t\t\tthis.sendDataContent(dataContent);\r\n\t\t} else {\r\n\t\t\t// 加到待发送列表\r\n\t\t\tconsole.log(\"isSocketOpen=\" + isSocketOpen);\r\n\t\t\tthis.socketMsgQueue.push(dataContent);\r\n\t\t\tconsole.log(this.socketMsgQueue);\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * 向 netty 服务器发送 DataConten 对象\r\n\t * @param {Object} dataContent\r\n\t */\r\n\tsendDataContent(dataContent) {\r\n\t\tvar data = JSON.stringify(dataContent);\r\n\t\tuni.sendSocketMessage({\r\n\t\t\tdata: data,\r\n\t\t});\r\n\t\t\r\n\t\tif (dataContent.action == app.netty.CHAT) {\r\n\t\t\t// 保存聊天历史到本地缓存，保存聊天快照到本地\r\n\t\t\tvar chatMessage = dataContent.data;\r\n\t\t\t\r\n\t\t\t// console.log(\"发消息的时间戳：\" + createDate);\r\n\t\t\tapp.chat.saveUserChatHistory(chatMessage.senderId, \r\n\t\t\t\t\t\t\t\t\t\t chatMessage.receiverId, \r\n\t\t\t\t\t\t\t\t\t\t chatMessage.msg, \r\n\t\t\t\t\t\t\t\t\t\t app.chat.ME, \r\n\t\t\t\t\t\t\t\t\t\t chatMessage.createDate);\r\n\t\t\tapp.chat.saveUserChatSnapshot(chatMessage.senderId, \r\n\t\t\t\t\t\t\t\t\t\t  chatMessage.receiverId, \r\n\t\t\t\t\t\t\t\t\t\t  chatMessage.msg, \r\n\t\t\t\t\t\t\t\t\t\t  app.chat.READ, \r\n\t\t\t\t\t\t\t\t\t\t  chatMessage.createDate);\r\n\t\t\t// 刷到对话窗口\r\n\t\t\tapp.$store.commit('doFlashChatPage');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * 批量签收聊天消息\r\n\t * @param {Object} msgIds\r\n\t */\r\n\tsignMsgList(msgIds) {\r\n\t\tvar dataContent = new app.netty.DataContent(app.netty.SIGNED, null, msgIds);\r\n\t\tthis.sendDataContent(dataContent);\r\n\t},\r\n\t\r\n\t/**\r\n\t * 批量签收点赞文章消息\r\n\t * @param {Object} msgIds\r\n\t */\r\n\tsignLikeArticleList(msgIds) {\r\n\t\tvar dataContent = new app.netty.DataContent(app.netty.LIKEARTICLE_SIGN, null, msgIds);\r\n\t\tthis.sendDataContent(dataContent);\r\n\t},\r\n\t\r\n\t/**\r\n\t * 批量签收点赞评论消息\r\n\t * @param {Object} msgIds\r\n\t */\r\n\tsignLikeCommentList(msgIds) {\r\n\t\tvar dataContent = new app.netty.DataContent(app.netty.LIKECOMMENT_SIGN, null, msgIds);\r\n\t\tthis.sendDataContent(dataContent);\r\n\t},\r\n\t\r\n\t/**\r\n\t * 批量签收评论消息\r\n\t * @param {Object} msgIds\r\n\t */\r\n\tsignCommentList(msgIds) {\r\n\t\tvar dataContent = new app.netty.DataContent(app.netty.COMMENT_SIGN, null, msgIds);\r\n\t\tthis.sendDataContent(dataContent);\r\n\t},\r\n\r\n\t/**\r\n\t * 发送心跳\r\n\t */\r\n\tkeepAlive() {\r\n\t\t// 用 setInterval 调用时，使用 this 获取不到实例，故用 app\r\n\t\tvar dataContent = new app.netty.DataContent(app.netty.KEEPALIVE, null, null);\r\n\t\tapp.mySocket.sendDataContent(dataContent);\r\n\t},\r\n}\r\n\r\nVue.prototype.chat = {\r\n\r\n\tME: 1, // 我的消息-右边\r\n\tFRIEND: 2, // 对方消息-左边\r\n\tREAD: 3,\r\n\tUNREAD: 4,\r\n\t/**\r\n\t * 历史记录对象\r\n\t * @param {Object} myId\r\n\t * @param {Object} friendId\r\n\t * @param {Object} msg\r\n\t * @param {Object} flag 是我的消息还是朋友的消息\r\n\t * @param {Object} createDate\r\n\t */\r\n\tChatHistory: function(myId, friendId, msg, flag, createDate) {\r\n\t\tthis.myId = myId;\r\n\t\tthis.friendId = friendId;\r\n\t\tthis.msg = msg;\r\n\t\tthis.flag = flag;\r\n\t\tthis.createDate = createDate;\r\n\t},\r\n\r\n\t/**\r\n\t * 快照对象\r\n\t * @param {Object} myId\r\n\t * @param {Object} friendId\r\n\t * @param {Object} msg\r\n\t * @param {Object} isRead 用于判断消息是已读还是未读\r\n\t * @param {Object} createDate\r\n\t */\r\n\tChatSnapshot: function(myId, friendId, msg, isRead, createDate) {\r\n\t\tthis.myId = myId;\r\n\t\tthis.friendId = friendId;\r\n\t\tthis.msg = msg;\r\n\t\tthis.isRead = isRead;\r\n\t\tthis.createDate = createDate;\r\n\t},\r\n\t/**\r\n\t * 保存用户的聊天记录\r\n\t * @param {Object} myId\r\n\t * @param {Object} friendId\r\n\t * @param {Object} msg\r\n\t * @param {Object} flag 判断本条消息是谁发送的, 1：我 2：朋友\r\n\t * @param {Object} createDate\r\n\t */\r\n\tsaveUserChatHistory: function(myId, friendId, msg, flag, createDate) {\r\n\r\n\t\tvar chatKey = \"chat-\" + myId + \"-\" + friendId;\r\n\t\t// 从本地缓存获取聊天记录是否存在\r\n\t\tvar chatHistoryListStr = uni.getStorageSync(chatKey);\r\n\t\tvar chatHistoryList;\r\n\t\tif (app.isNull(chatHistoryListStr)) {\r\n\t\t\t// 为空，赋一个空的list；\r\n\t\t\tchatHistoryList = [];\r\n\t\t} else {\r\n\t\t\t// 不为空\r\n\t\t\tchatHistoryList = JSON.parse(chatHistoryListStr);\r\n\t\t}\r\n\r\n\t\t// 构建聊天记录对象\r\n\t\tvar singleMsg = new this.ChatHistory(myId, friendId, msg, flag, createDate);\r\n\r\n\t\t// 添加到list尾部\r\n\t\tchatHistoryList.push(singleMsg);\r\n\r\n\t\tuni.setStorageSync(chatKey, JSON.stringify(chatHistoryList));\r\n\r\n\t},\r\n\t\r\n\t/**\r\n\t * 分页获取聊天历史，从列表尾部开始读取(反取)\r\n\t * @param {Object} myId\r\n\t * @param {Object} friendId\r\n\t * @param {Object} page\r\n\t */\r\n\tgetUserChatHistory: function(myId, friendId, page) {\r\n\t\tvar chatKey = \"chat-\" + myId + \"-\" + friendId;\r\n\t\tvar list = app.getListByKey(chatKey).reverse();\r\n\t\tvar size = 20;\r\n\t\tvar start = (page-1) * size;\r\n\t\tvar newList = [];\r\n\t\tif (list.length < start){\r\n\t\t\treturn null;\r\n\t\t}else{\r\n\t\t\tfor (var i=0; i<size; i++){\r\n\t\t\t\tif(!app.isNull(list[start+i])){\r\n\t\t\t\t\tnewList.unshift(list[start+i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn newList;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * 删除我和朋友的聊天记录\r\n\t * @param {Object} myId\r\n\t * @param {Object} friendId\r\n\t */\r\n\tdeletUserChatHistory: function(myId, friendId) {\r\n\t\tvar chatKey = \"chat-\" + myId + \"-\" + friendId;\r\n\t\tuni.removeStorageSync(chatKey);\r\n\t},\r\n\r\n\t/**\r\n\t * 聊天记录快照，仅保存每次和朋友聊天的最后一条消息\r\n\t * @param {Object} myId\r\n\t * @param {Object} friendId\r\n\t * @param {Object} msg\r\n\t * @param {Object} isRead\r\n\t * @param {Object} createDate\r\n\t */\r\n\tsaveUserChatSnapshot: function(myId, friendId, msg, isRead, createDate) {\r\n\r\n\t\tvar chatKey = \"chat-snapshot\" + myId;\r\n\r\n\t\t// 从本地缓存获取聊天快照的 list\r\n\t\tvar chatSnapshotListStr = uni.getStorageSync(chatKey);\r\n\t\tvar chatSnapshotList;\r\n\t\tif (app.isNull(chatSnapshotListStr)) {\r\n\t\t\t// 为空，赋一个空的list；\r\n\t\t\tchatSnapshotList = [];\r\n\t\t} else {\r\n\t\t\t// 不为空\r\n\t\t\tchatSnapshotList = JSON.parse(chatSnapshotListStr);\r\n\t\t\t// 循环快照list，删除含 friendId 的项\r\n\t\t\tfor (var i = 0; i < chatSnapshotList.length; i++) {\r\n\t\t\t\tif (chatSnapshotList[i].friendId == friendId) {\r\n\t\t\t\t\tchatSnapshotList.splice(i, 1); // 从i项往后删，只删一个\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 构建聊天快照对象\r\n\t\tvar singleMsg = new this.ChatSnapshot(myId, friendId, msg, isRead, createDate);\r\n\t\t// 添加到 list 第一项\r\n\t\tchatSnapshotList.unshift(singleMsg);\r\n\r\n\t\tuni.setStorageSync(chatKey, JSON.stringify(chatSnapshotList));\r\n\t},\r\n\r\n\t/**\r\n\t * 获取用户快照记录列表\r\n\t */\r\n\tgetUserChatSnapShot: function(myId) {\r\n\t\tvar chatKey = \"chat-snapshot\" + myId;\r\n\r\n\t\t// 从本地缓存获取聊天快照的 list\r\n\t\tvar chatSnapshotListStr = uni.getStorageSync(chatKey);\r\n\t\tvar chatSnapshotList;\r\n\t\tif (app.isNull(chatSnapshotListStr)) {\r\n\t\t\t// 为空，赋一个空的list；\r\n\t\t\tchatSnapshotList = [];\r\n\t\t} else {\r\n\t\t\t// 不为空\r\n\t\t\tchatSnapshotList = JSON.parse(chatSnapshotListStr);\r\n\t\t}\r\n\r\n\t\treturn chatSnapshotList;\r\n\t},\r\n\r\n\t/**\r\n\t * 删除与该用户的聊天快照记录\r\n\t * @param {Object} myId\r\n\t * @param {Object} friendId\r\n\t */\r\n\tdeletUserChatSnapShot: function(myId, friendId) {\r\n\t\tvar chatKey = \"chat-snapshot\" + myId;\r\n\t\t// 从本地缓存获取聊天快照的 list\r\n\t\tvar chatSnapshotListStr = uni.getStorageSync(chatKey);\r\n\t\tvar chatSnapshotList;\r\n\t\tif (app.isNull(chatSnapshotListStr)) {\r\n\t\t\t// 为空，不作处理\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\t// 不为空\r\n\t\t\tchatSnapshotList = JSON.parse(chatSnapshotListStr);\r\n\t\t\t// 循环快照list，删除含 friendId 的项\r\n\t\t\tfor (var i = 0; i < chatSnapshotList.length; i++) {\r\n\t\t\t\tif (chatSnapshotList[i].friendId == friendId) {\r\n\t\t\t\t\tchatSnapshotList.splice(i, 1); // 从i项往后删，只删一个\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tuni.setStorageSync(chatKey, JSON.stringify(chatSnapshotList));\r\n\t},\r\n\r\n\t/**\r\n\t * 把快照标记为已读，并且不改变在列表中的位置\r\n\t * @param {Object} myId\r\n\t * @param {Object} friendId\r\n\t */\r\n\treadUserChatSnapShot: function(myId, friendId) {\r\n\t\tvar chatKey = \"chat-snapshot\" + myId;\r\n\r\n\t\t// 从本地缓存获取聊天快照的 list\r\n\t\tvar chatSnapshotListStr = uni.getStorageSync(chatKey);\r\n\t\tvar chatSnapshotList;\r\n\t\tif (app.isNull(chatSnapshotListStr)) {\r\n\t\t\t// 为空，赋一个空的list；\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\t// 不为空\r\n\t\t\tchatSnapshotList = JSON.parse(chatSnapshotListStr);\r\n\t\t\t// 删除快照对象并放入新的在原有位置\r\n\t\t\tfor (var i = 0; i < chatSnapshotList.length; i++) {\r\n\t\t\t\tvar item = chatSnapshotList[i];\r\n\t\t\t\tif (item.friendId == friendId) {\r\n\t\t\t\t\titem.isRead = this.READ;\r\n\t\t\t\t\tchatSnapshotList.splice(i, 1, item); // 替换\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tuni.setStorageSync(chatKey, JSON.stringify(chatSnapshotList));\r\n\t\t}\r\n\t},\r\n\r\n\tfetchUnsignedChatMsg: function() {\r\n\t\tvar user = app.getGlobalUserInfo();\r\n\t\tvar msgIds = \",\" // 格式: ,1001,1002,1003,\r\n\t\tvar that = this;\r\n\t\tuni.request({\r\n\t\t\turl: app.$serverUrl + '/user/getUnsignedMsg',\r\n\t\t\tmethod: \"POST\",\r\n\t\t\tdata: {\r\n\t\t\t\tuserId: user.id\r\n\t\t\t},\r\n\t\t\theader: {\r\n\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n\t\t\t},\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\t// console.log(res)\r\n\t\t\t\tif (res.data.status == 200) {\r\n\t\t\t\t\tvar unsignedMsgList = res.data.data;\r\n\t\t\t\t\tconsole.log(unsignedMsgList);\r\n\t\t\t\t\tif (!app.isNull(unsignedMsgList)) {\r\n\t\t\t\t\t\tapp.$store.commit('setMyMsgCount', unsignedMsgList.length); // 增加 msgCount in index.js\r\n\t\t\t\t\t\tfor (var i = 0; i < unsignedMsgList.length; i++) {\r\n\t\t\t\t\t\t\tvar msgObj = unsignedMsgList[i];\r\n\t\t\t\t\t\t\t// 1.逐条存入聊天记录\r\n\t\t\t\t\t\t\tthis.saveUserChatHistory(msgObj.acceptUserId,\r\n\t\t\t\t\t\t\t\tmsgObj.sendUserId,\r\n\t\t\t\t\t\t\t\tmsgObj.msg,\r\n\t\t\t\t\t\t\t\tthis.FRIEND,\r\n\t\t\t\t\t\t\t\tmsgObj.createDate);\r\n\t\t\t\t\t\t\t// 2.保存聊天快照到本地\r\n\t\t\t\t\t\t\tthis.saveUserChatSnapshot(msgObj.acceptUserId,\r\n\t\t\t\t\t\t\t\tmsgObj.sendUserId,\r\n\t\t\t\t\t\t\t\tmsgObj.msg,\r\n\t\t\t\t\t\t\t\tthis.UNREAD,\r\n\t\t\t\t\t\t\t\tmsgObj.createDate);\r\n\t\t\t\t\t\t\t// 3.拼接批量签收id的字符串\r\n\t\t\t\t\t\t\tmsgIds += msgObj.id + \",\";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 调用批量签收方法\r\n\t\t\t\t\t\tapp.mySocket.signMsgList(msgIds);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/**\r\n * 点赞评论通知\r\n */\r\nVue.prototype.notification={\t\r\n\tLIKEMSG_KEY : \"likeMsg\" + app.getGlobalUserInfo().id,\r\n\tCOMMENTMSG_KEY : \"commentMsg\" + app.getGlobalUserInfo().id,\r\n\t/**\r\n\t * 把点赞通知存入缓存\r\n\t * @param {Object} dataContent\r\n\t */\r\n\tsaveLikeMsg(dataContent){\r\n\t\tapp.addIntoList(dataContent, this.LIKEMSG_KEY);\r\n\t},\r\n\t\r\n\tgetLikeMsg(page){\r\n\t\tvar size = 10;\r\n\t\tvar list = app.getListByKey(this.LIKEMSG_KEY);\r\n\t\tvar start = (page-1) * size;\r\n\t\tvar newList = [];\r\n\t\tif (list.length < start){\r\n\t\t\treturn null;\r\n\t\t}else{\r\n\t\t\tfor (var i=0; i<size; i++){\r\n\t\t\t\tif(!app.isNull(list[start+i])){\r\n\t\t\t\t\tnewList.push(list[start+i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn newList;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * 把评论通知存入缓存\r\n\t * @param {Object} dataContent\r\n\t */\r\n\tsaveCommentMsg(dataContent){\r\n\t\tapp.addIntoList(dataContent, this.COMMENTMSG_KEY);\r\n\t},\r\n\t\r\n\tgetCommentMsg(page){\r\n\t\tvar size = 10;\r\n\t\tvar list = app.getListByKey(this.COMMENTMSG_KEY);\r\n\t\tvar start = (page-1) * size;\r\n\t\tvar newList = [];\r\n\t\tif (list.length < start){\r\n\t\t\treturn null;\r\n\t\t}else{\r\n\t\t\tfor (var i=0; i<size; i++){\r\n\t\t\t\tif(!app.isNull(list[start+i])){\r\n\t\t\t\t\tnewList.push(list[start+i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn newList;\r\n\t\t}\r\n\t},\r\n\t\r\n\t/**\r\n\t * 获取并签收未签收的点赞通知\r\n\t */\r\n\tfetchUnsignedLikeMsg(){\r\n\t\tvar user = app.getGlobalUserInfo();\r\n\t\tvar likeArticleIds = \",\" // 格式: ,1001,1002,1003,\r\n\t\tvar likeCommentIds = \",\"\r\n\t\tvar that = this;\r\n\t\tuni.request({\r\n\t\t\turl: app.$serverUrl + '/article/getUnsignedLikeMsg',\r\n\t\t\tmethod: \"POST\",\r\n\t\t\tdata: {\r\n\t\t\t\tuserId: user.id\r\n\t\t\t},\r\n\t\t\theader: {\r\n\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n\t\t\t},\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\t// console.log(res)\r\n\t\t\t\tif (res.data.status == 200) {\r\n\t\t\t\t\tvar unsignedMsgList = res.data.data;\r\n\t\t\t\t\tconsole.log(unsignedMsgList);\r\n\t\t\t\t\tif (!app.isNull(unsignedMsgList)) {\r\n\t\t\t\t\t\tfor (var i = 0; i < unsignedMsgList.length; i++) {\r\n\t\t\t\t\t\t\tvar dataContent = unsignedMsgList[i];\r\n\t\t\t\t\t\t\t//累加信息\r\n\t\t\t\t\t\t\tapp.$store.commit('setMyMsgCount'); // 累加通用信息\r\n\t\t\t\t\t\t\tapp.$store.commit('setLikeMsgCount'); //累加点赞信息\r\n\t\t\t\t\t\t\t// 逐条存入缓存\r\n\t\t\t\t\t\t\tapp.notification.saveLikeMsg(dataContent);\r\n\t\t\t\t\t\t\t// 拼接批量签收id的字符串\r\n\t\t\t\t\t\t\tswitch (dataContent.action){\r\n\t\t\t\t\t\t\t\tcase app.netty.LIKEARTICLE:\r\n\t\t\t\t\t\t\t\t\tlikeArticleIds += dataContent.data.source.id + \",\";\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tcase app.netty.LIKECOMMENT:\r\n\t\t\t\t\t\t\t\t\tlikeCommentIds += dataContent.data.source.id + \",\";\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\r\n\t\t\t\t\t\t// 调用批量签收方法\r\n\t\t\t\t\t\tapp.mySocket.signLikeArticleList(likeArticleIds);\r\n\t\t\t\t\t\tapp.mySocket.signLikeCommentList(likeCommentIds);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * 获取并签收未签收的评论通知\r\n\t */\r\n\tfetchUnsignedCommentMsg(){\r\n\t\tvar user = app.getGlobalUserInfo();\r\n\t\tvar commentIds = \",\" // 格式: ,1001,1002,1003,\r\n\t\tvar that = this;\r\n\t\tuni.request({\r\n\t\t\turl: app.$serverUrl + '/article/getUnsignedCommentMsg',\r\n\t\t\tmethod: \"POST\",\r\n\t\t\tdata: {\r\n\t\t\t\tuserId: user.id\r\n\t\t\t},\r\n\t\t\theader: {\r\n\t\t\t\t'content-type': 'application/x-www-form-urlencoded'\r\n\t\t\t},\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\t// console.log(res)\r\n\t\t\t\tif (res.data.status == 200) {\r\n\t\t\t\t\tvar unsignedMsgList = res.data.data;\r\n\t\t\t\t\tconsole.log(unsignedMsgList);\r\n\t\t\t\t\tif (!app.isNull(unsignedMsgList)) {\r\n\t\t\t\t\t\tfor (var i = 0; i < unsignedMsgList.length; i++) {\r\n\t\t\t\t\t\t\tvar dataContent = unsignedMsgList[i];\r\n\t\t\t\t\t\t\t//累加信息\r\n\t\t\t\t\t\t\tapp.$store.commit('setMyMsgCount'); // 累加通用信息\r\n\t\t\t\t\t\t\tapp.$store.commit('setCommentMsgCount'); //累加评论信息\r\n\t\t\t\t\t\t\t// 逐条存入缓存\r\n\t\t\t\t\t\t\tapp.notification.saveCommentMsg(dataContent);\r\n\t\t\t\t\t\t\t// 拼接批量签收id的字符串\r\n\t\t\t\t\t\t\tcommentIds += dataContent.data.source.id + \",\";\r\n\t\t\t\t\t\t}\r\n\t\t\r\n\t\t\t\t\t\t// 调用批量签收方法\r\n\t\t\t\t\t\tapp.mySocket.signCommentList(commentIds);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nVue.prototype.netty = {\r\n\t/**\r\n\t * 和后端的枚举对应\r\n\t */\r\n\tCONNECT: 1, \t\t\t// 第一次(或重连)初始化连接\r\n\tCHAT: 2,\t\t\t\t// 聊天消息\r\n\tSIGNED: 3, \t\t\t\t// 消息签收\r\n\tKEEPALIVE: 4, \t\t\t// 客户端保持心跳\r\n\tLIKEARTICLE: 5, \t\t// 点赞文章通知\r\n\tLIKECOMMENT: 6, \t\t// 点赞评论通知\r\n\tCOMMENTARTICLE: 7, \t\t// 评论文章通知\r\n\tCOMMENTCOMMENT: 8,\t\t// 评论评论通知\r\n\tLIKEARTICLE_SIGN: 9, \t// 签收点赞文章通知\r\n\tLIKECOMMENT_SIGN: 10, \t// 签收点赞评论通知\r\n\tCOMMENT_SIGN: 11, \t\t// 签收评论文章通知\r\n\r\n\t/**\r\n\t * 和后端 ChatMessage 聊天模型的对象保持一致\r\n\t * @param {Object} senderId\r\n\t * @param {Object} receiverId\r\n\t * @param {Object} msg\r\n\t * @param {Object} msgId\r\n\t * @param {Object} createDate\r\n\t */\r\n\tChatMessage: function(senderId, receiverId, msg, msgId, createDate) {\r\n\t\tthis.senderId = senderId;\r\n\t\tthis.receiverId = receiverId;\r\n\t\tthis.msg = msg;\r\n\t\tthis.msgId = msgId; // 前端发送设置null就好\r\n\t\tthis.createDate = createDate;\r\n\t},\r\n\t\r\n\t/**\r\n\t * 构建消息 DataContent 模型对象\r\n\t * @param {Object} action\r\n\t * @param {Object} data\r\n\t * @param {Object} extand\r\n\t */\r\n\tDataContent: function(action, data, extand) {\r\n\t\tthis.action = action;\r\n\t\tthis.data = data;\r\n\t\tthis.extand = extand;\r\n\t},\r\n}\r\n\r\n/**\r\n * Timestamp 渲染\r\n * @param {Object} timediff\r\n */\r\nVue.prototype.timeDeal = function(timediff) {\r\n\tconsole.log(timediff);\r\n\ttimediff = new Date(timediff);\r\n\tconsole.log(timediff);\r\n\tvar parts = [timediff.getFullYear(), timediff.getMonth(), timediff.getDate(), timediff.getHours(), timediff.getMinutes(),\r\n\t\ttimediff.getSeconds()\r\n\t];\r\n\tvar oldTime = timediff.getTime();\r\n\tvar now = new Date();\r\n\tvar newTime = now.getTime();\r\n\tvar milliseconds = 0;\r\n\tvar timeSpanStr;\r\n\tmilliseconds = newTime - oldTime;\r\n\tif (milliseconds <= 1000 * 60 * 1) {\r\n\t\ttimeSpanStr = '刚刚';\r\n\t} else if (1000 * 60 * 1 < milliseconds && milliseconds <= 1000 * 60 * 60) {\r\n\t\ttimeSpanStr = Math.round((milliseconds / (1000 * 60))) + '分钟前';\r\n\t} else if (1000 * 60 * 60 * 1 < milliseconds && milliseconds <= 1000 * 60 * 60 * 24) {\r\n\t\ttimeSpanStr = Math.round(milliseconds / (1000 * 60 * 60)) + '小时前';\r\n\t} else if (1000 * 60 * 60 * 24 < milliseconds && milliseconds <= 1000 * 60 * 60 * 24 * 15) {\r\n\t\ttimeSpanStr = Math.round(milliseconds / (1000 * 60 * 60 * 24)) + '天前';\r\n\t\t\r\n\t} else if (milliseconds > 1000 * 60 * 60 * 24 * 15 && parts[0] == now.getFullYear()) {\r\n\t\ttimeSpanStr = parts[1] + '-' + parts[2] + ' ' + parts[3] + ':' + parts[4];\r\n\t} else {\r\n\t\ttimeSpanStr = parts[0] + '-' + parts[1] + '-' + parts[2] + ' ' + parts[3] + ':' + parts[4];\r\n\t}\r\n\treturn timeSpanStr;\r\n}\r\n\r\n// 封装tabbar索引，避免重复书写\r\nVue.mixin({\r\n  methods:{\r\n    setTabBarIndex(index){\r\n      if (typeof this.$mp.page.getTabBar === 'function' &&\r\n        this.$mp.page.getTabBar()) {\r\n        this.$mp.page.getTabBar().setData({\r\n          selected:index\r\n        })\r\n      }\r\n    }\r\n  }\r\n})\r\n\r\n//判断屏幕尺寸并分类,实现兼容不同设备\r\n// vue.prototype.screenSize = function(){\r\n// \tuni.getSystemInfo({\r\n// \t\tsuccess: function (res) {\r\n// \t\t        console.log(res.model);\r\n// \t\t        console.log(res.pixelRatio);\r\n// \t\t        console.log(res.windowWidth);\r\n// \t\t        console.log(res.windowHeight);\r\n// \t\t        console.log(res.language);\r\n// \t\t        console.log(res.platform);\r\n// \t\t    }\r\n// \t})\r\n// }","var render, staticRenderFns, recyclableRender, components\nvar renderjs\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\XMQ\\\\Hbuilder\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('87ffae96')) {\n      api.createRecord('87ffae96', component.options)\n    } else {\n      api.reload('87ffae96', component.options)\n    }\n    \n  }\n}\ncomponent.options.__file = \"nuoquan/nuoquan-client/App.vue\"\nexport default component.exports","import mod from \"-!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=script&lang=js&\"","\nexport default {\n\tonLaunch: function() {\n\t\tconsole.log('App Launch')\n\t},\n\tonShow: function() {\n\t\tconsole.log('App Show')\n\t},\n\tonHide: function() {\n\t\tconsole.log('App Hide')\n\t},\n\n}\n","import mod from \"-!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-1!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/index.js??ref--6-oneOf-1-2!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-1!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/index.js??ref--6-oneOf-1-2!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../Hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./App.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin"],"sourceRoot":""}