(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/submit/submit"],{2331:function(e,t,i){"use strict";var n=i("e4c8"),a=i.n(n);a.a},"3c92":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("viwe",{attrs:{mpcomid:"71c3a564-0"}},[i("view",{staticStyle:{height:"45px",width:"100%",background:"url(../../static/BG/submitBG.png)","background-repeat":"no-repeat","background-position-y":"-5px","background-size":"750rpx 80px"}},[i("view",{staticClass:"submit",attrs:{eventid:"71c3a564-0"},on:{click:e.upload}},[e._v("发 表")])]),i("view",{staticClass:"submitMain"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.articleTitle,expression:"articleTitle"}],staticClass:"title",attrs:{placeholder:"标题",maxlength:"20",eventid:"71c3a564-1"},domProps:{value:e.articleTitle},on:{input:function(t){t.target.composing||(e.articleTitle=t.target.value)}}}),i("view",{staticStyle:{display:"flex","justify-content":"space-between",color:"#353535","font-size":"13px","line-height":"28px",height:"24px"}},[i("view",[e._v("还可以输入")]),i("view",[e._v(e._s(20-e.articleTitle.length)+"字")])]),i("view",{staticClass:"tagsArea"},[e._l(e.tagList,function(t,n){return e.showTagArea?i("view",{key:n,staticClass:"tag",attrs:{eventid:"71c3a564-2-"+n},on:{click:function(t){e.deleteTag(n)}}},[e._v(e._s(t))]):e._e()}),i("view",{staticClass:"addTag"},[e.showAddTagButton?i("view",{attrs:{eventid:"71c3a564-3"},on:{click:e.addTag}},[e._v("+ 添加标签")]):e._e(),e.showInputTagArea?i("input",{directives:[{name:"model",rawName:"v-model",value:e.articleTag,expression:"articleTag"}],attrs:{focus:"true",placeholder:"请输入标签...",maxlength:"10",eventid:"71c3a564-4"},domProps:{value:e.articleTag},on:{blur:e.checkInput,input:function(t){t.target.composing||(e.articleTag=t.target.value)}}}):e._e()])],2),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.articleContent,expression:"articleContent"}],staticClass:"content",attrs:{placeholder:"内容",maxlength:"140","show-confirm-bar":!1,eventid:"71c3a564-5"},domProps:{value:e.articleContent},on:{input:function(t){t.target.composing||(e.articleContent=t.target.value)}}}),i("view",{staticStyle:{display:"flex","justify-content":"space-between",color:"#353535","font-size":"13px","line-height":"28px",height:"24px"}},[i("view",[e._v("还可以输入")]),i("view",[e._v(e._s(140-e.articleContent.length)+"字")])]),i("view",{staticClass:"picturearea"},[e._l(e.imageList,function(t,n){return i("block",{key:n},[i("view",{staticStyle:{position:"relative"}},[i("image",{attrs:{src:t,"data-src":t,mode:"aspectFill",eventid:"71c3a564-6-"+n},on:{tap:e.previewImage}}),i("view",{staticStyle:{width:"15px",height:"15px","font-size":"10px","line-height":"10px","border-bottom-left-radius":"3px",background:"rgba(166, 169, 168,0.3)",color:"#FFFFFF",position:"absolute",top:"6px",right:"0","text-align":"center"},attrs:{eventid:"71c3a564-7-"+n},on:{click:function(t){e.deleteImg(n)}}},[e._v("✕")])])])}),i("view",{directives:[{name:"show",rawName:"v-show",value:e.isAddImage(this.imageList.length),expression:"isAddImage(this.imageList.length)"}],staticClass:"addPic",attrs:{id:"clickToChooseImage",eventid:"71c3a564-8"},on:{click:e.chooseImg}},[e._v("+")]),1==e.imageList.length||4==e.imageList.length||7==e.imageList.length?i("view",{staticStyle:{width:"190rpx",height:"190rpx",margin:"6px 0"}}):e._e()],2)])])},a=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return a})},"3cd2":function(e,t,i){"use strict";i.r(t);var n=i("3c92"),a=i("9935");for(var o in a)"default"!==o&&function(e){i.d(t,e,function(){return a[e]})}(o);i("2331");var s=i("2877"),r=Object(s["a"])(a["default"],n["a"],n["b"],!1,null,null,null);t["default"]=r.exports},"3e20":function(e,t,i){"use strict";(function(t){var i;function n(){var e=0,t=plus.ios.import("PHPhotoLibrary"),i=t.authorizationStatus();return e=0===i?null:3==i?1:0,plus.ios.deleteObject(t),e}function a(){var e=0,t=plus.ios.import("AVCaptureDevice"),i=t.authorizationStatusForMediaType("vide");return e=0===i?null:3==i?1:0,plus.ios.deleteObject(t),e}function o(){var e=0,t=plus.ios.import("CLLocationManager"),i=t.locationServicesEnabled(),n=t.authorizationStatus();return e=i?0===n?null:3===n||4===n?1:0:2,plus.ios.deleteObject(t),e}function s(){var e=0,t=plus.ios.import("UIApplication"),i=t.sharedApplication(),n=0;if(i.currentUserNotificationSettings){var a=i.currentUserNotificationSettings();n=a.plusGetAttribute("types"),0==n?(e=0,console.log("推送权限没有开启")):(e=1,console.log("已经开启推送功能!")),plus.ios.deleteObject(a)}else n=i.enabledRemoteNotificationTypes(),0==n?(e=3,console.log("推送权限没有开启!")):(e=4,console.log("已经开启推送功能!"));return plus.ios.deleteObject(i),plus.ios.deleteObject(t),e}function r(){var e=0,t=plus.ios.import("CNContactStore");t.authorizationStatusForEntityType(0);return e=0===authStatus?null:3==authStatus?1:0,plus.ios.deleteObject(t),e}function l(){var e=null,t=plus.ios.import("AVAudioSession"),i=t.sharedInstance(),n=i.recordPermission();return console.log("permissionStatus:"+n),e=1970168948===n?null:1735552628===n?1:0,plus.ios.deleteObject(t),e}function c(){var e=null,t=plus.ios.import("EKEventStore"),i=t.authorizationStatusForEntityType(0);return 3==i?(e=1,console.log("日历权限已经开启")):console.log("日历权限没有开启"),plus.ios.deleteObject(t),e}function u(){var e=null,t=plus.ios.import("EKEventStore"),i=t.authorizationStatusForEntityType(1);return 3==i?(e=1,console.log("备忘录权限已经开启")):console.log("备忘录权限没有开启"),plus.ios.deleteObject(t),e}function d(e){return new Promise(function(t,i){switch(e){case"push":t(s());break;case"location":t(o());break;case"record":t(l());break;case"camera":t(a());break;case"album":t(n());break;case"contact":t(r());break;case"calendar":t(c());break;case"memo":t(u());break;default:t(0);break}})}function p(e){return new Promise(function(t,i){plus.android.requestPermissions([e],function(e){for(var i=0,n=0;n<e.granted.length;n++){var a=e.granted[n];console.log("已获取的权限："+a),i=1}for(n=0;n<e.deniedPresent.length;n++){var o=e.deniedPresent[n];console.log("拒绝本次申请的权限："+o),i=0}for(n=0;n<e.deniedAlways.length;n++){var s=e.deniedAlways[n];console.log("永久拒绝申请的权限："+s),i=-1}t(i)},function(e){console.log("result error: "+e.message),t({code:e.code,message:e.message})})})}function g(){if(f.isIOS){var e=plus.ios.import("UIApplication"),t=e.sharedApplication(),i=plus.ios.import("NSURL"),n=i.URLWithString("app-settings:");t.openURL(n),plus.ios.deleteObject(n),plus.ios.deleteObject(i),plus.ios.deleteObject(t)}else{var a=plus.android.importClass("android.content.Intent"),o=plus.android.importClass("android.provider.Settings"),s=plus.android.importClass("android.net.Uri"),r=plus.android.runtimeMainActivity(),l=new a;l.setAction(o.ACTION_APPLICATION_DETAILS_SETTINGS);var c=s.fromParts("package",r.getPackageName(),null);l.setData(c),r.startActivity(l)}}function h(){var e=plus.ios.import("UIApplication"),t=e.sharedApplication(),i=plus.ios.import("NSURL"),n=i.URLWithString("App-prefs:root=General");t.openURL(n),plus.ios.deleteObject(n),plus.ios.deleteObject(i),plus.ios.deleteObject(t)}var f={get isIOS(){return"boolean"===typeof i?i:i="ios"===t.getSystemInfoSync().platform},requestIOS:d,requestAndroid:p,gotoAppSetting:g,gotoiOSSetting:h};e.exports=f}).call(this,i("6e42")["default"])},"49d6":function(e,t,i){"use strict";i("5ad9");var n=o(i("b0ce")),a=o(i("3cd2"));function o(e){return e&&e.__esModule?e:{default:e}}Page((0,n.default)(a.default))},9935:function(e,t,i){"use strict";i.r(t);var n=i("bb47"),a=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);t["default"]=a.a},bb47:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(i("a34a"));a(i("3e20"));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t,i,n,a,o,s){try{var r=e[o](s),l=r.value}catch(c){return void i(c)}r.done?t(l):Promise.resolve(l).then(n,a)}function s(e){return function(){var t=this,i=arguments;return new Promise(function(n,a){var s=e.apply(t,i);function r(e){o(s,n,a,r,l,"next",e)}function l(e){o(s,n,a,r,l,"throw",e)}r(void 0)})}}var r=[["camera"],["album"],["camera","album"]],l=[["compressed"],["original"],["compressed","original"]],c=!1,u={data:function(){return{userInfo:"",articleTitle:"",articleContent:"",articleTag:"",imgPath:"",showInputTagArea:0,showAddTagButton:1,showTagArea:0,tagList:[],finalTag:"",tagIndex:0,imageList:[],sourceTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],sizeTypeIndex:0,sizeType:["压缩","原图","压缩或原图"],countIndex:8,count:[1,2,3,4,5,6,7,8,9]}},onUnload:function(){this.imageList=[],this.sourceTypeIndex=2,this.sourceType=["拍照","相册","拍照或相册"],this.sizeTypeIndex=0,this.sizeType=["压缩","原图","压缩或原图"],this.countIndex=8},onLoad:function(){this.userInfo=this.getGlobalUserInfo()},methods:{addTag:function(){this.showInputTagArea=1,this.showAddTagButton=0},checkInput:function(e){var t=this,i=this.articleTag;this.isNull(i)?(t.showAddTagButton=1,t.showInputTagArea=0):(t.showTagArea=1,t.tagList[t.tagIndex]=i,t.tagIndex=t.tagIndex+1,t.showAddTagButton=1,t.showInputTagArea=0,t.articleTag="")},combineTagToString:function(e){for(var t=this,i=0;i<t.tagList.length;i++)t.finalTag=t.finalTag+"#"+t.tagList[i]},sourceTypeChange:function(e){this.sourceTypeIndex=parseInt(e.target.value)},sizeTypeChange:function(e){this.sizeTypeIndex=e.target.value},countChange:function(e){this.countIndex=e.target.value},chooseImg:function(){var t=s(n.default.mark(function t(){var i=this;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.chooseImage({sourceType:r[this.sourceTypeIndex],sizeType:l[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(e){i.imageList=i.imageList.concat(e.tempFilePaths),console.log(e)}});case 1:case"end":return t.stop()}},t,this)}));function i(){return t.apply(this,arguments)}return i}(),previewImage:function(t){var i=t.target.dataset.src;console.log(this.imageList),e.previewImage({current:i,urls:this.imageList})},isAddImage:function(){return!(this.imageList.length>=9)},upload:function(t){var i=this,n=this;""!=n.articleTitle&&null!=n.articleTitle?""!=n.articleContent&&null!=n.articleContent?c?console.log("正在上传..."):(c=!0,e.showLoading({title:"正在上传..."}),setTimeout(function(){n.combineTagToString();var t=n.$serverUrl;e.request({url:t+"/article/uploadArticle",method:"POST",data:{userId:n.userInfo.id,articleTag:n.finalTag,articleTitle:n.articleTitle,articleContent:n.articleContent},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){if(200==t.data.status)if(n.imageList.length>0)for(var a=t.data.data,o=0,s=0;s<n.imageList.length;s++)e.uploadFile({url:i.$serverUrl+"/article/uploadArticleImg",filePath:n.imageList[s],name:"file",formData:{userId:n.userInfo.id,articleId:a,order:s},success:function(e){o++,o==n.imageList.length&&n.uploadSuccess()}});else n.uploadSuccess();else n.uploadFail()},fail:function(e){n.uploadFail()}})},100)):e.showToast({icon:"none",title:"文章内容不能为空～",duration:1e3}):e.showToast({icon:"none",title:"文章标题不能为空～",duration:1e3})},uploadSuccess:function(){c=!1,e.hideLoading(),e.$emit("flash"),e.navigateBack({delta:1}),e.showToast({title:"上传成功",duration:2e3,icon:"success"})},uploadFail:function(){c=!1,e.hideLoading(),e.showToast({title:"出现未知错误，上传失败",duration:2e3,icon:"none"})},deleteTag:function(e){console.log(e);this.tagList[e];this.tagList.splice(e,1),console.log(this.tagList.length),this.tagIndex=this.tagList.length},deleteImg:function(e){this.imageList.splice(e,1)}}};t.default=u}).call(this,i("6e42")["default"])},e4c8:function(e,t,i){}},[["49d6","common/runtime","common/vendor"]]]);