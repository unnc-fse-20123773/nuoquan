(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chatpage/chatpage"],{1029:function(t,e,n){},"1f2f":function(t,e,n){"use strict";n.r(e);var i=n("d1af"),s=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=s.a},2178:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("d0ed")),s=n("2f62");function a(t){return t&&t.__esModule?t:{default:t}}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){r(t,e,n[e])})}return t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var c,u,f=1,l={components:{onemessage:i.default},data:function(){return{chatContent:[],socketMsgQueue:[],textMsg:"",windowHeight:"",scrollToView:"",userInfo:"",friendInfo:""}},computed:o({},(0,s.mapState)(["chatMessageCard","flashChatPage"])),watch:{chatMessageCard:function(t,e){this.chatContent.push(t),this.scrollToBottom()},flashChatPage:function(t,e){var n=this.getListByKey(c),i=n[n.length-1];i.id=this.generateId(0),this.chatContent.push(i),this.scrollToBottom()}},onLoad:function(e){f=1,this.friendInfo=JSON.parse(e.friendInfo),t.setNavigationBarTitle({title:this.friendInfo.nickname});var n=this.getGlobalUserInfo();if(this.isNull(n))console.log("No userInfo!!");else{this.userInfo=n;var i=this;t.getSystemInfo({success:function(t){i.windowHeight=t.windowHeight}}),c="chat-"+this.userInfo.id+"-"+this.friendInfo.id,u=this.getListByKey(c),this.getChatHistory(),this.$nextTick(function(){this.scrollToBottom()})}},methods:{scroll:function(t){},sendText:function(){this.textMsg&&(this.mySocket.sendObj(this.netty.CHAT,this.friendInfo.id,this.textMsg,null),this.textMsg="")},getChatHistory:function(){var t=this.getChatHistoryPage(f),e=this;t.forEach(function(t,n){t.id=e.generateId(n)}),this.chatContent=t},loadMore:function(){var e=this;if(!this.isHistoryLoading){this.isHistoryLoading=!0;var n=this.chatContent[0].id;t.showLoading({title:"加载中"});var i=f+1,s=this.chat.getUserChatHistory(this.userInfo.id,this.friendInfo.id,i);setTimeout(function(){if(null!=s){var i=e;s.forEach(function(t,e){t.id=i.generateId(e)}),e.chatContent=s.concat(e.chatContent),f++}t.hideLoading(),e.$nextTick(function(){this.scrollToView=n}),e.isHistoryLoading=!1},300)}},getChatHistoryPage:function(t){var e=u.reverse(),n=20,i=(t-1)*n,s=[];if(e.length<i)return null;for(var a=0;a<n;a++)this.isNull(e[i+a])||s.unshift(e[i+a]);return s},generateId:function(t){var e="m"+Math.floor(1e3*Math.random())+"-"+t+(new Date).valueOf();return e},scrollToBottom:function(){console.log(this.chatContent),this.scrollToView=this.chatContent[this.chatContent.length-1].id}}};e.default=l}).call(this,n("6e42")["default"])},"4b63":function(t,e,n){"use strict";n.r(e);var i=n("2178"),s=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=s.a},"4e29":function(t,e,n){},"5b6c":function(t,e,n){"use strict";var i=n("77d9"),s=n.n(i);s.a},"77d9":function(t,e,n){},7909:function(t,e,n){"use strict";var i=n("ac6a"),s=n.n(i);s.a},"82b9":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",[n("view",[t.thisMessage.flag==t.ME?n("view",{staticClass:"send"},[n("view",{attrs:{eventid:"bbb360c4-0"},on:{tap:function(e){t.goToPersonPublic(t.userInfo.id)}}},[n("image",{staticClass:"touxiang",attrs:{src:t.userInfo.faceImg}})]),n("view",{staticClass:"content"},[n("view",{staticClass:"contentText-send"},[t._v(t._s(t.thisMessage.msg))]),n("view",{staticClass:"bottomBar"},[n("view",{staticClass:"time-send"},[t._v(t._s(t.thisMessage.createDate))]),t.thisMessage.isRead?t._e():n("view",{staticClass:"status-send"}),t.thisMessage.messageStatus?n("view",{staticClass:"status-send",staticStyle:{color:"#3FC24A"}},[t._v("√")]):t._e()])])]):t._e()]),n("view",[t.thisMessage.flag==t.FRIEND?n("view",{staticClass:"recieve"},[n("view",{attrs:{eventid:"bbb360c4-1"},on:{tap:function(e){t.goToPersonPublic(t.friendInfo.id)}}},[n("image",{staticClass:"touxiang",attrs:{src:t.friendInfo.faceImg}})]),n("view",{staticClass:"content"},[n("view",{staticClass:"contentText-recieve"},[t._v(t._s(t.thisMessage.msg))]),n("view",{staticClass:"bottomBar"},[n("view",{staticClass:"time-recieve"},[t._v(t._s(t.thisMessage.createDate))])])])]):t._e()])])},s=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return s})},"9e10":function(t,e,n){"use strict";var i=n("1029"),s=n.n(i);s.a},ac6a:function(t,e,n){},b275:function(t,e,n){},c6ff:function(t,e,n){"use strict";var i=n("4e29"),s=n.n(i);s.a},d0ed:function(t,e,n){"use strict";n.r(e);var i=n("82b9"),s=n("1f2f");for(var a in s)"default"!==a&&function(t){n.d(e,t,function(){return s[t]})}(a);n("7909"),n("e154"),n("c6ff");var o=n("2877"),r=Object(o["a"])(s["default"],i["a"],i["b"],!1,null,"610e942a",null);e["default"]=r.exports},d1af:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={props:{userInfo:"",friendInfo:"",thisMessage:{}},data:function(){return{ME:this.chat.ME,FRIEND:this.chat.FRIEND}},onReady:function(){},methods:{goToPersonPublic:function(e){t.redirectTo({url:"../personpublic/personpublic?userId="+e})}}};e.default=n}).call(this,n("6e42")["default"])},d899:function(t,e,n){"use strict";n("5ad9");var i=a(n("b0ce")),s=a(n("f26d"));function a(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(s.default))},e154:function(t,e,n){"use strict";var i=n("b275"),s=n.n(i);s.a},e2a0:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticStyle:{height:"100%",width:"100%",background:"#F5F5F5"}},[n("scroll-view",{staticClass:"messageArea",attrs:{"scroll-y":"true","scroll-into-view":t.scrollToView,eventid:"37bb6204-0"},on:{scrolltoupper:t.loadMore,scroll:t.scroll}},[t._l(t.chatContent,function(e,i){return n("onemessage",{key:i,attrs:{thisMessage:e,userInfo:t.userInfo,friendInfo:t.friendInfo,id:e.id,mpcomid:"37bb6204-0-"+i}})}),n("view",{staticClass:"marginHelper"})],2),n("view",{staticClass:"bottomBar"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textMsg,expression:"textMsg"}],attrs:{"auto-height":"true","show-confirm-bar":!1,eventid:"37bb6204-1"},domProps:{value:t.textMsg},on:{input:function(e){e.target.composing||(t.textMsg=e.target.value)}}}),n("view",{staticClass:"icons"},[n("button",[n("image",{attrs:{src:"../../static/icon/viewLocalPic.png"}})]),n("button",[n("image",{attrs:{src:"../../static/icon/emoji.png"}})]),n("button",{attrs:{eventid:"37bb6204-2"},on:{click:function(e){t.sendText(t.textMsg)}}},[n("image",{attrs:{src:"../../static/icon/littlePlane.png"}})])],1)])],1)},s=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return s})},f26d:function(t,e,n){"use strict";n.r(e);var i=n("e2a0"),s=n("4b63");for(var a in s)"default"!==a&&function(t){n.d(e,t,function(){return s[t]})}(a);n("5b6c"),n("9e10");var o=n("2877"),r=Object(o["a"])(s["default"],i["a"],i["b"],!1,null,"2fc35fd4",null);e["default"]=r.exports}},[["d899","common/runtime","common/vendor"]]]);